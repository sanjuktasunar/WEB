@using PagedList;
@using PagedList.Mvc;

@model Web.Entity.Dto.UserSite.ProductPageDto
@{
    ViewBag.Title = "Product";
    Layout = "~/Views/Shared/_FrontLayout.cshtml";
}

@{
    var obj = new Web.Entity.Dto.UserSite.DisplayParamters();
    var param = obj.GetParameters();
    var link = obj.GetMenuLink();
}

<style>
    .py-5 {
        padding-top: 1rem !important;
        padding-bottom: 1rem !important;
    }
    .text-decoration-none{
        margin-bottom:2%;
    }
</style>


<div class="service-tag py-5 bg-secondary">
    <div class="col-md-12">
        <h3 class="h3 semi-bold-600 text-center mt-2">@param.OurProducts</h3>
    </div>
</div>

<section class="container py-5">
    <div class="input-group">
        <div class="form-outline">
            <input type="search" id="query" value="@ViewBag.query" class="form-control" placeholder="@param.Search ........" />
        </div>
        <button type="button" id="btnSearch" class="btn btn-primary">
            <i class="bx bx-search text-white"></i>
        </button>
    </div><br />
    @if (Model.GetAllProducts.Count() > 0)
    {
        <div class="row projects gx-lg-5">
            @foreach (var x in Model.GetAllProducts)
            {
                <a href="~/ProductDetails/@x.ProductId" class="col-sm-3 col-lg-3 text-decoration-none project marketing social business">
                    <div class="service-work overflow-hidden card mb-5 mx-5 m-sm-0">
                        <img class="card-img-top" src="data:image;base64,@Convert.ToBase64String(x.Photo)" alt="..." style="width:100%;height:200px;">
                        <div class="card-body">
                            <h5 class="card-title light-300 text-dark">@x.ProductNameNepali</h5>
                            <p class="card-text light-300 text-dark">
                                @foreach (var price in x.GetProductPrice.Take(1))
                                {
                                    <span class="card-text">@param.Per @price.UnitName - @param.Rs                       @price.SellingPrice</span> <br />
                                }
                            </p>
                            <span class="text-decoration-none text-primary light-300">
                                Read more <i class='bx bxs-hand-right ms-1'></i>
                            </span>
                        </div>
                    </div>
                </a>
            }
        </div>

        <br />
        <div class="row">
            <div class="btn-toolbar justify-content-center pb-4" role="toolbar" aria-label="Toolbar with button groups">

                @{
                    int pageNumber = Model.GetAllProducts.PageNumber;
                    int previousPage = pageNumber - 1;
                    int nextPage = pageNumber + 1;
                }
                <div class="btn-group me-2" role="group" aria-label="First group">
                    @if (pageNumber == 1)
                    {
                        <button type="button" class="btn btn-secondary text-white" disabled>Previous</button>
                    }
                    else
                    {
                        <a href="~/Products?page=@previousPage" class="btn btn-secondary text-white search">Previous</a>
                    }
                </div>
                @for (int i = 1; i <= Model.GetAllProducts.PageCount; i++)
                {
                    <div class="btn-group me-2" role="group" aria-label="Second group">
                        <a href="~/Products?page=@i" class="@(i == pageNumber ? "btn btn-light search" : "btn btn-secondary text-white search")">@i</a>
                    </div>
                }

                <div class="btn-group" role="group" aria-label="Third group">
                    @if (pageNumber == Model.GetAllProducts.PageCount)
                    {
                        <button type="button" class="btn btn-secondary text-white" disabled>Next</button>
                    }
                    else
                    {
                        <a href="~/Products?page=@nextPage" class="btn btn-secondary text-white search">Next</a>
                    }
                </div>
            </div>
        </div>
    }

    else
    {
        <p style="color:red">Sorry! Product cannot Found...!!</p>
    }
</section>
@Scripts.Render("~/web/front-end")

<script>
    $("#btnSearch").click(function () {
        var query = $("#query").val();
        window.location.href = "/Products?query=" + query;
    })
    $(".search").click(function (evt) {
        evt.preventDefault();
        var query = $("#query").val();
        var pageNumber = $(this).html();
        if (pageNumber.trim() == 'Next') {
            pageNumber = parseInt('@Model.GetAllProducts.PageNumber') + 1;
        }
        else  if (pageNumber.trim() == 'Previous') {
            pageNumber = parseInt('@Model.GetAllProducts.PageNumber') - 1;
        }
        window.location.href = "/Products?query=" + query + "&page=" + pageNumber;
    });
</script>

